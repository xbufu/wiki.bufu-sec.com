<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://wiki.bufu-sec.com/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://wiki.bufu-sec.com/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var b=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("theme");b&&a===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),b&&a==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),a==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://wiki.bufu-sec.com/main.0f654c3ff85d49ec2f8e1b93cc77c73eea9982de1c671d3b15e3941bd8b058f47b32d2a41437c456be8245c526e216841a6dfcb50958f1ea4f0e418befc4cdfc.css integrity="sha512-D2VMP/hdSewvjhuTzHfHPuqZgt4cZx07FeOUG9iwWPR7MtKkFDfEVr6CRcUm4haEGm38tQlY8epPDkGL78TN/A==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Kerberos - Bufu-Sec Wiki</title><meta name=description content="Information about Kerberos."><link rel=canonical href=https://wiki.bufu-sec.com/active_directory/general/kerberos/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Kerberos"><meta property="og:description" content="Information about Kerberos."><meta property="og:url" content="https://wiki.bufu-sec.com/active_directory/general/kerberos/"><meta property="og:site_name" content="Bufu-Sec Wiki"><meta property="article:published_time" content="2021-11-06T11:53:35+01:00"><meta property="article:modified_time" content="2021-11-06T11:53:35+01:00"><meta property="og:image" content="https://wiki.bufu-sec.com/bufu.jpg"><meta property="og:image:alt" content="Bufu-Sec Wiki"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@0xBufu"><meta name=twitter:creator content="@0xBufu"><meta name=twitter:title content="Kerberos"><meta name=twitter:description content="Information about Kerberos."><meta name=twitter:image content="https://wiki.bufu-sec.com/bufu.jpg"><meta name=twitter:image:alt content="Kerberos"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://wiki.bufu-sec.com/#/schema/person/1","name":"Bufu-Sec Wiki","url":"https://wiki.bufu-sec.com/","sameAs":["https://twitter.com/0xBufu","https://github.com/xbufu/wiki"],"image":{"@type":"ImageObject","@id":"https://wiki.bufu-sec.com/#/schema/image/1","url":"https://wiki.bufu-sec.com/bufu.jpg","width":1280,"height":640,"caption":"Bufu-Sec Wiki"}},{"@type":"WebSite","@id":"https://wiki.bufu-sec.com/#/schema/website/1","url":"https://wiki.bufu-sec.com/","name":"Bufu-Sec Wiki","description":"The Bufu-Sec Wiki is a collection of notes and resources, mostly related to Red Teaming.","publisher":{"@id":"https://wiki.bufu-sec.com/#/schema/person/1"}},{"@type":"WebPage","@id":"https://wiki.bufu-sec.com/active_directory/general/kerberos/","url":"https://wiki.bufu-sec.com/active_directory/general/kerberos/","name":"Kerberos","description":"Information about Kerberos.","isPartOf":{"@id":"https://wiki.bufu-sec.com/#/schema/website/1"},"about":{"@id":"https://wiki.bufu-sec.com/#/schema/person/1"},"datePublished":"2021-11-06T11:53:35CET","dateModified":"2021-11-06T11:53:35CET","breadcrumb":{"@id":"https://wiki.bufu-sec.com/active_directory/general/kerberos/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://wiki.bufu-sec.com/active_directory/general/kerberos/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://wiki.bufu-sec.com/active_directory/general/kerberos/"]}]},{"@type":"BreadcrumbList","@id":"https://wiki.bufu-sec.com/active_directory/general/kerberos/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://wiki.bufu-sec.com/","url":"https://wiki.bufu-sec.com/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://wiki.bufu-sec.com/active_directory/","url":"https://wiki.bufu-sec.com/active_directory/","name":"Active Directory"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://wiki.bufu-sec.com/active_directory/general/","url":"https://wiki.bufu-sec.com/active_directory/general/","name":"General"}},{"@type":"ListItem","position":4,"item":{"@id":"https://wiki.bufu-sec.com/active_directory/general/kerberos/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://wiki.bufu-sec.com/active_directory/general/kerberos/#/schema/image/2","url":"https://wiki.bufu-sec.com/bufu.jpg","contentUrl":"https://wiki.bufu-sec.com/bufu.jpg","caption":"Kerberos"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://wiki.bufu-sec.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://wiki.bufu-sec.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://wiki.bufu-sec.com/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://wiki.bufu-sec.com/site.webmanifest></head><body class="active_directory single"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label="Bufu-Sec Wiki">Bufu-Sec Wiki</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-start border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>Bufu-Sec Wiki</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=/active_directory/general/general/>Active Directory</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://bufu-sec.com/>Blog</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/xbufu><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://twitter.com/0xBufu><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><small class="ms-2 d-md-none">Twitter</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-xxl d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder=Search... aria-label=Search... autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section- aria-expanded=false>
help</button><div class=collapse id=section-><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/help/how-to-update/>How to Update</a></li><li><a class="docs-link rounded" href=/docs/help/troubleshooting/>Troubleshooting</a></li><li><a class="docs-link rounded" href=/docs/help/faq/>FAQ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section- aria-expanded=false>
prologue</button><div class=collapse id=section-><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/docs/prologue/quick-start/>Quick Start</a></li><li><a class="docs-link rounded" href=/docs/prologue/commands/>Commands</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-general aria-expanded=true>
General</button><div class="collapse show" id=section-general><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/general/general/>General Information</a></li><li><a class="docs-link rounded" href=/active_directory/general/installation/>Installation</a></li><li><a class="docs-link rounded" href=/active_directory/general/dns/>DNS</a></li><li><a class="docs-link rounded active" href=/active_directory/general/kerberos/>Kerberos</a></li><li><a class="docs-link rounded" href=/active_directory/general/kerberos_delegation/>Kerberos Delegation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-domain_enumeration aria-expanded=false>
Domain Enumeration</button><div class=collapse id=section-domain_enumeration><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/domain_enumeration/powershell/>PowerShell</a></li><li><a class="docs-link rounded" href=/active_directory/domain_enumeration/ad_module/>ActiveDirectory Module</a></li><li><a class="docs-link rounded" href=/active_directory/domain_enumeration/powerview/>PowerView</a></li><li><a class="docs-link rounded" href=/active_directory/domain_enumeration/kerbrute/>Kerbrute</a></li><li><a class="docs-link rounded" href=/active_directory/domain_enumeration/bloodhound/>BloodHound</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-domain_privilege_escalation aria-expanded=false>
Domain PrivEsc</button><div class=collapse id=section-domain_privilege_escalation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/domain_privilege_escalation/as-rep_roasting/>AS-REP Roasting</a></li><li><a class="docs-link rounded" href=/active_directory/domain_privilege_escalation/kerberoasting/>Kerberoasting</a></li><li><a class="docs-link rounded" href=/active_directory/domain_privilege_escalation/delegation_attacks/>Delegation Attacks</a></li><li><a class="docs-link rounded" href=/active_directory/domain_privilege_escalation/dns_admins/>DNS Admins</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-domain_persistence aria-expanded=false>
Domain Persistence</button><div class=collapse id=section-domain_persistence><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/domain_persistence/golden_tickets/>Golden Tickets</a></li><li><a class="docs-link rounded" href=/active_directory/domain_persistence/silver_tickets/>Silver Tickets</a></li><li><a class="docs-link rounded" href=/active_directory/domain_persistence/acl_attacks/>ACL Persistence</a></li><li><a class="docs-link rounded" href=/active_directory/domain_persistence/dsrm/>DSRM</a></li><li><a class="docs-link rounded" href=/active_directory/domain_persistence/custom_ssps/>Custom SSPs</a></li><li><a class="docs-link rounded" href=/active_directory/domain_persistence/dcshadow/>DC Shadow</a></li><li><a class="docs-link rounded" href=/active_directory/domain_persistence/skeleton_key/>Skeleton Key</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lateral_movement aria-expanded=false>
Lateral Movement</button><div class=collapse id=section-lateral_movement><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/lateral_movement/ps_remoting/>PowerShell Remoting</a></li><li><a class="docs-link rounded" href=/active_directory/lateral_movement/credential_dumping/>Credential Dumping</a></li><li><a class="docs-link rounded" href=/active_directory/lateral_movement/dc_sync/>DC Sync</a></li><li><a class="docs-link rounded" href=/active_directory/lateral_movement/overpass_the_hash/>Overpass-the-Hash</a></li><li><a class="docs-link rounded" href=/active_directory/lateral_movement/ticket_harvesting/>Ticket Harvesting</a></li><li><a class="docs-link rounded" href=/active_directory/lateral_movement/pass_the_ticket/>Pass-the-Ticket</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-trust_attacks aria-expanded=false>
Trust Attacks</button><div class=collapse id=section-trust_attacks><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/trust_attacks/cross_domain_attacks/>Cross-Domain Attacks</a></li><li><a class="docs-link rounded" href=/active_directory/trust_attacks/cross_forest_attacks/>Cross-Forest Attacks</a></li><li><a class="docs-link rounded" href=/active_directory/trust_attacks/mssql_servers/>MS-SQL Servers</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-mitm_relay aria-expanded=false>
MITM & Relay Attacks</button><div class=collapse id=section-mitm_relay><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/mitm_relay/llmnr_poisoning/>LLMNR Poisoning</a></li><li><a class="docs-link rounded" href=/active_directory/mitm_relay/ipv6_attacks/>IPv6 Attacks</a></li><li><a class="docs-link rounded" href=/active_directory/mitm_relay/smb_relay/>SMB Relay</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-detection_and_defense aria-expanded=false>
Detection & Defense</button><div class=collapse id=section-detection_and_defense><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/active_directory/detection_and_defense/architectural_changes/>Architectural Changes</a></li><li><a class="docs-link rounded" href=/active_directory/detection_and_defense/domain_admins/>Domain Admins</a></li><li><a class="docs-link rounded" href=/active_directory/detection_and_defense/microsoft_ata/>Microsoft Advanced Threat Analytics (ATA)</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#authentication-process>Authentication Process</a></li><li><a href=#terminology>Terminology</a><ul><li><a href=#ticket-granting-ticket-tgt>Ticket Granting Ticket (TGT)</a></li><li><a href=#key-distribution-center-kdc>Key Distribution Center (KDC)</a></li><li><a href=#authentication-service-as>Authentication Service (AS)</a></li><li><a href=#ticket-granting-service-tgs>Ticket Granting Service (TGS)</a></li><li><a href=#service-principal-name-spn>Service Principal Name (SPN)</a></li><li><a href=#kdc-long-term-secret-key-kdc-lt-key>KDC Long Term Secret Key (KDC LT Key)</a></li><li><a href=#client-long-term-secret-key-client-lt-key>Client Long Term Secret Key (Client LT Key)</a></li><li><a href=#service-long-term-secret-key-service-lt-key>Service Long Term Secret Key (Service LT Key)</a></li><li><a href=#session-key>Session Key</a></li><li><a href=#privilege-attribute-certificate-pac>Privilege Attribute Certificate (PAC)</a></li></ul></li><li><a href=#as-req-with-pre-authentication>AS-REQ with Pre-Authentication</a><ul><li><a href=#ticket-granting-ticket-contents>Ticket Granting Ticket Contents</a></li><li><a href=#service-ticket-contents>Service Ticket Contents</a></li></ul></li><li><a href=#kerberos-tickets-overview>Kerberos Tickets Overview</a></li><li><a href=#attack-privilege-requirements>Attack Privilege Requirements</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Kerberos</h1><p class=lead>Information Kerberos, such as important terminology and the authentication process.</p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#authentication-process>Authentication Process</a></li><li><a href=#terminology>Terminology</a><ul><li><a href=#ticket-granting-ticket-tgt>Ticket Granting Ticket (TGT)</a></li><li><a href=#key-distribution-center-kdc>Key Distribution Center (KDC)</a></li><li><a href=#authentication-service-as>Authentication Service (AS)</a></li><li><a href=#ticket-granting-service-tgs>Ticket Granting Service (TGS)</a></li><li><a href=#service-principal-name-spn>Service Principal Name (SPN)</a></li><li><a href=#kdc-long-term-secret-key-kdc-lt-key>KDC Long Term Secret Key (KDC LT Key)</a></li><li><a href=#client-long-term-secret-key-client-lt-key>Client Long Term Secret Key (Client LT Key)</a></li><li><a href=#service-long-term-secret-key-service-lt-key>Service Long Term Secret Key (Service LT Key)</a></li><li><a href=#session-key>Session Key</a></li><li><a href=#privilege-attribute-certificate-pac>Privilege Attribute Certificate (PAC)</a></li></ul></li><li><a href=#as-req-with-pre-authentication>AS-REQ with Pre-Authentication</a><ul><li><a href=#ticket-granting-ticket-contents>Ticket Granting Ticket Contents</a></li><li><a href=#service-ticket-contents>Service Ticket Contents</a></li></ul></li><li><a href=#kerberos-tickets-overview>Kerberos Tickets Overview</a></li><li><a href=#attack-privilege-requirements>Attack Privilege Requirements</a></li></ul></nav></div></nav><h2 id=introduction>Introduction <a href=#introduction class=anchor aria-hidden=true>#</a></h2><ul><li>Default authentication service for AD domains</li><li>Uses 3rd party ticket autorization as well as stronger encryption than NTLM</li></ul><hr><h2 id=authentication-process>Authentication Process <a href=#authentication-process class=anchor aria-hidden=true>#</a></h2><ol><li>Client encrypts a timestamp with his NTLM hash and sends it to the KDC (<code>AS-REQ</code>)</li><li>KDC encrypts TGT with user NTLM, signs it and sends it back to the user (<code>AS-REP</code>). Only <code>krbtgt</code> can open and read TGT data</li><li>Clients encrypts TGT with <code>krbtgt</code> NTLM hash when requesting a TGS ticket (<code>TGS-REQ</code>)</li><li>KDC encrypts TGS with target service&rsquo;s NTLM hash and sends it back to the client (<code>TGS-REP</code>)</li><li>User connects to the server hosting the service on the appropriate port & presents the TGS (<code>AP-REQ</code>)</li><li>Service validates the ticket and checks weather the user can access it or not</li></ol><hr><h2 id=terminology>Terminology <a href=#terminology class=anchor aria-hidden=true>#</a></h2><h3 id=ticket-granting-ticket-tgt>Ticket Granting Ticket (TGT) <a href=#ticket-granting-ticket-tgt class=anchor aria-hidden=true>#</a></h3><p>Authentication ticket used to request service tickets from the TGS for specific resources from the domain.</p><h3 id=key-distribution-center-kdc>Key Distribution Center (KDC) <a href=#key-distribution-center-kdc class=anchor aria-hidden=true>#</a></h3><p>A service issuing TGTs and service tickets that consist of the Authentication Service and the Ticket Granting Service.</p><h3 id=authentication-service-as>Authentication Service (AS) <a href=#authentication-service-as class=anchor aria-hidden=true>#</a></h3><p>Issues TGTs to be used by the TGS i nthe domain to request access to other machines and service tickets.</p><h3 id=ticket-granting-service-tgs>Ticket Granting Service (TGS) <a href=#ticket-granting-service-tgs class=anchor aria-hidden=true>#</a></h3><p>Takes the TGT and returns a ticket to a machine on the domain.</p><h3 id=service-principal-name-spn>Service Principal Name (SPN) <a href=#service-principal-name-spn class=anchor aria-hidden=true>#</a></h3><p>Identifier given to a service instance to associate a service instance with a domain service account. Windows requires that services have a domain service account which is why a service needs an SPN set.</p><h3 id=kdc-long-term-secret-key-kdc-lt-key>KDC Long Term Secret Key (KDC LT Key) <a href=#kdc-long-term-secret-key-kdc-lt-key class=anchor aria-hidden=true>#</a></h3><p>KDC key is based on the KRBTGT service account. Used to encrypt the TGT and sign the PAC.</p><h3 id=client-long-term-secret-key-client-lt-key>Client Long Term Secret Key (Client LT Key) <a href=#client-long-term-secret-key-client-lt-key class=anchor aria-hidden=true>#</a></h3><p>Client key is based on the computer or service account. It is used to check the encrypted timestampt and encrypt the session key.</p><h3 id=service-long-term-secret-key-service-lt-key>Service Long Term Secret Key (Service LT Key) <a href=#service-long-term-secret-key-service-lt-key class=anchor aria-hidden=true>#</a></h3><p>The service key is based on the service account. It is used to encrypt the service portion of the service ticket and sign the PAC.</p><h3 id=session-key>Session Key <a href=#session-key class=anchor aria-hidden=true>#</a></h3><p>Issued by the KDC when a TGT is issued. The user will provide the session key to the KDC along with the TGT when requesting a service ticket.</p><h3 id=privilege-attribute-certificate-pac>Privilege Attribute Certificate (PAC) <a href=#privilege-attribute-certificate-pac class=anchor aria-hidden=true>#</a></h3><p>The PAC holds all of the user&rsquo;s relevant information, it is sent along with the TGT to the KDC to be signed by the Target LT Key and the KDC LT Key in order to validate the user.</p><hr><h2 id=as-req-with-pre-authentication>AS-REQ with Pre-Authentication <a href=#as-req-with-pre-authentication class=anchor aria-hidden=true>#</a></h2><ul><li>Starts when a user requests a TGT from the KDC</li><li>To validate the user and create a TGT for him, KDC must follow certain steps<ul><li>User encrypts a timestamp NT hash and send it to the AS</li><li>KDC attempts to decrypt the timestampt using the user&rsquo;s NT hash</li><li>If successful, KDC will issue TGT and session key for the user</li></ul></li></ul><h3 id=ticket-granting-ticket-contents>Ticket Granting Ticket Contents <a href=#ticket-granting-ticket-contents class=anchor aria-hidden=true>#</a></h3><ul><li>TGT is provided by the user to KDC</li><li>KDC validates ticket and returns service ticket</li><li>Content:<ul><li>Start/end/validity time</li><li>Service name</li><li>Target name</li><li>Client name</li><li>Session key</li><li>PCA</li><li>Signed with<ul><li>Service LT Key</li><li>KDC LT Key</li></ul></li></ul></li></ul><h3 id=service-ticket-contents>Service Ticket Contents <a href=#service-ticket-contents class=anchor aria-hidden=true>#</a></h3><ul><li>Contains two portions: service-provided portion & user-provided portion</li><li>Service portion<ul><li>User details</li><li>Session key</li><li>Encrypts the ticket with service account NTLM hash</li></ul></li><li>User portion<ul><li>Validity timestamp</li><li>Session key</li><li>Encrypts with the TGT session key</li></ul></li></ul><hr><h2 id=kerberos-tickets-overview>Kerberos Tickets Overview <a href=#kerberos-tickets-overview class=anchor aria-hidden=true>#</a></h2><ul><li>TGT comes in various formats<ul><li>.kirbi for Rubeus</li><li>.ccache for Impacket</li></ul></li><li>Ticket is base64 encoded</li><li>Once user gives TGT to server, it then<ul><li>gets user details & session key</li><li>encrypts ticket with service NTLM hash</li></ul></li><li>KDC will authenticate TGT and return service ticket</li><li>Normal TGT will only work for the target service</li><li>KRBTGT allows you to get any service ticket to gain access to anything in the domain</li></ul><hr><h2 id=attack-privilege-requirements>Attack Privilege Requirements <a href=#attack-privilege-requirements class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>Attack</th><th>Requirements</th></tr></thead><tbody><tr><td>Kerbrute Enumeration</td><td>No domain access required</td></tr><tr><td>Pass the Ticket</td><td>Access as a user to the domain required</td></tr><tr><td>Kerberoasting</td><td>Access as any user required</td></tr><tr><td>AS-REP Roasting</td><td>Access as any user required</td></tr><tr><td>Golden Ticket</td><td>Full domain compromise (domain admin) required</td></tr><tr><td>Silver Ticket</td><td>Service hash required</td></tr><tr><td>Skeleton Key</td><td>Full domain compromise (domain admin) required</td></tr></tbody></table><div class="docs-navigation d-flex justify-content-between"><a href=/active_directory/domain_persistence/dsrm/><div class="card my-1"><div class="card-body py-2">&larr; DSRM</div></div></a><a class=ms-auto href=/active_directory/domain_enumeration/kerbrute/><div class="card my-1"><div class="card-body py-2">Kerbrute &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.592b9faf6c83a2bda564a377cf82f9a67546b198510a93fdb0728f9622ec22729d44be02fb2ea16c3fe5365ae1806259cd111932ca28e68b66462d6937635bab.js integrity="sha512-WSufr2yDor2lZKN3z4L5pnVGsZhRCpP9sHKPliLsInKdRL4C+y6hbD/lNlrhgGJZzREZMsoo5otmRi1pN2Nbqw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.e13cfba4c5524e30386cb9ea71f0f191f39d15b25b222f4b67549689f7c076158f42a2282446044f5cdacc76a6d003efbfa252a84aea0116703803b6339ae35f.js integrity="sha512-4Tz7pMVSTjA4bLnqcfDxkfOdFbJbIi9LZ1SWiffAdhWPQqIoJEYET1zazHam0APvv6JSqErqARZwOAO2M5rjXw==" crossorigin=anonymous defer></script>
<script src=/main.min.bfb6b781dd5fd7177a7a9b3ce0bd84f12db95f6aa4e3fc7b339cd57879c38390d1e8d75cf314836a71201ba2fd6a2e26084a956704964c0bb884c26e9eff5ee1.js integrity="sha512-v7a3gd1f1xd6eps84L2E8S25X2qk4/x7M5zVeHnDg5DR6Ndc8xSDanEgG6L9ai4mCEqVZwSWTAu4hMJunv9e4Q==" crossorigin=anonymous defer></script>
<script src=https://wiki.bufu-sec.com/index.min.c55f22f03cfa2cd138ac2b4b1f7286662f7b15f65463d48de9bd3c016c6d3c931fbd8ab2bd461be74c468ddd1bec697aa69a62adb5af4b7f23a9a1db39019d2f.js integrity="sha512-xV8i8Dz6LNE4rCtLH3KGZi97FfZUY9SN6b08AWxtPJMfvYqyvUYb50xGjd0b7Gl6pppirbWvS38jqaHbOQGdLw==" crossorigin=anonymous defer></script></body></html>