<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>General on</title><link>https://wiki.bufu-sec.com/active_directory/general/</link><description>Recent content in General on</description><generator>Hugo -- gohugo.io</generator><language>en-US</language><lastBuildDate>Sat, 06 Nov 2021 10:02:54 +0100</lastBuildDate><atom:link href="https://wiki.bufu-sec.com/active_directory/general/index.xml" rel="self" type="application/rss+xml"/><item><title>General Information</title><link>https://wiki.bufu-sec.com/active_directory/general/general/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/general/general/</guid><description>Introduction # Used to manage Windows domain networks &amp;ldquo;Phone book&amp;rdquo; for Windows -&amp;gt; stores information about computers, users, etc. Authentication uses Kerberos tickets Can be exploited using intended functionality Physical AD Components # Domain controller server -&amp;gt; AD DS server role installed Domain controllers Host copy of AD DS directory store Provides authentication &amp;amp; authorization Replicate updates to other DCs in the domain and forest Administrative access to manage user accounts and network resources AD DS data store Contains db files and processes that store and manage directory information for users, services, and applications Consists of the Ntds.</description></item><item><title>Installation</title><link>https://wiki.bufu-sec.com/active_directory/general/installation/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/general/installation/</guid><description>Setup DNS # # Install normal DNS server Install-WindowsFeature DNS # Register DNS records cmd /c ipconfig -registerdns Install AD DS on Server Core # # Install AD DS and management tools Install-WindowsFeature -Name ad-domain-services -IncludeManagementTools # Install new forest and domain Install-ADDSForest -DomainName &amp;quot;lab.local&amp;quot; Add Domain Controller # # Add domain controller and prompt for credentials Install-ADDSDomainController -DomainName &amp;quot;lab.local&amp;quot; -Credential (Get-Credential Lab\Administrator) Create DC from IFM Media # &amp;quot; Create directory for image mkdir C:\ifm &amp;quot; Launch ntdsutil ntdsutil ntdsutil: activate instance ntds ntdsutil: ifm ifm: create sysvol full c:\ifm Transfer folder to target computer then run</description></item><item><title>DNS</title><link>https://wiki.bufu-sec.com/active_directory/general/dns/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/general/dns/</guid><description>General # Active Directory relies on DNS Locate machines and resources on the same domain Setup DNS # # Install normal DNS server Install-WindowsFeature DNS # Register DNS records cmd /c ipconfig -registerdns</description></item><item><title>Kerberos</title><link>https://wiki.bufu-sec.com/active_directory/general/kerberos/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/general/kerberos/</guid><description>Introduction # Default authentication service for AD domains Uses 3rd party ticket autorization as well as stronger encryption than NTLM Authentication Process # Client encrypts a timestamp with his NTLM hash and sends it to the KDC (AS-REQ) KDC encrypts TGT with user NTLM, signs it and sends it back to the user (AS-REP). Only krbtgt can open and read TGT data Clients encrypts TGT with krbtgt NTLM hash when requesting a TGS ticket (TGS-REQ) KDC encrypts TGS with target service&amp;rsquo;s NTLM hash and sends it back to the client (TGS-REP) User connects to the server hosting the service on the appropriate port &amp;amp; presents the TGS (AP-REQ) Service validates the ticket and checks weather the user can access it or not Terminology # Ticket Granting Ticket (TGT) # Authentication ticket used to request service tickets from the TGS for specific resources from the domain.</description></item><item><title>Kerberos Delegation</title><link>https://wiki.bufu-sec.com/active_directory/general/kerberos_delegation/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/general/kerberos_delegation/</guid><description>What is Kerberos Delegation? # Allows to &amp;ldquo;reuse the end-user credentials to access resources hosted on a different server&amp;rdquo; E.g. user authenticates to webserver, then webserver impersonates user to authenticate to database server But: Service account for web server must be trusted for delegation to impersonate user Authentication Process # User provides credentials to DC DC returns TGT User requests TGS for web service on Web Server Web server service account uses the user&amp;rsquo;s TGT to request TGS for the database server from the DC Web server service account connects to the database server as the user Types of Kerberos Delegation # Unconstrained # General/basic delegation Allows service to access any server on any computer in the domain Constrained # Allows service to request access only to specified computers/resources If user is not using Kerberos authentication to authenticate to web server, Windows offers Protocol Transition to transition the request to Kerberos</description></item></channel></rss>